

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>avalanche.benchmarks.datasets.downloadable_dataset &mdash; Avalanche 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../../_static/css/mystyle.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/mystyle.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../../genindex/" />
    <link rel="search" title="Search" href="../../../../../search/" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../">
          

          
            
            <img src="../../../../../_static/avalanche_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Avalanche API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../autoapi/">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../autoapi/avalanche/"><code class="xref py py-mod docutils literal notranslate"><span class="pre">avalanche</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../../autoapi/avalanche/#subpackages">Subpackages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../autoapi/avalanche/benchmarks/"><code class="xref py py-mod docutils literal notranslate"><span class="pre">avalanche.benchmarks</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../autoapi/avalanche/evaluation/"><code class="xref py py-mod docutils literal notranslate"><span class="pre">avalanche.evaluation</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../autoapi/avalanche/logging/"><code class="xref py py-mod docutils literal notranslate"><span class="pre">avalanche.logging</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../autoapi/avalanche/models/"><code class="xref py py-mod docutils literal notranslate"><span class="pre">avalanche.models</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../../autoapi/avalanche/training/"><code class="xref py py-mod docutils literal notranslate"><span class="pre">avalanche.training</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../autoapi/avalanche/#submodules">Submodules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../autoapi/avalanche/core/"><code class="xref py py-mod docutils literal notranslate"><span class="pre">avalanche.core</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../../autoapi/avalanche/#package-contents">Package Contents</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../../autoapi/avalanche/#avalanche.__version__">__version__</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../">Avalanche</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../../">Module code</a> &raquo;</li>
        
      <li>avalanche.benchmarks.datasets.downloadable_dataset</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for avalanche.benchmarks.datasets.downloadable_dataset</h1><div class="highlight"><pre>
<span></span><span class="c1">################################################################################</span>
<span class="c1"># Copyright (c) 2021 ContinualAI.                                              #</span>
<span class="c1"># Copyrights licensed under the MIT License.                                   #</span>
<span class="c1"># See the accompanying LICENSE file for terms.                                 #</span>
<span class="c1">#                                                                              #</span>
<span class="c1"># Date: 25-05-2021                                                             #</span>
<span class="c1"># Author: Lorenzo Pellegrini                                                   #</span>
<span class="c1"># E-mail: contact@continualai.org                                              #</span>
<span class="c1"># Website: www.continualai.org                                                 #</span>
<span class="c1">################################################################################</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">abstractmethod</span><span class="p">,</span> <span class="n">ABC</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span>

<span class="kn">import</span> <span class="nn">shutil</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">torch.utils.data.dataset</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">T_co</span>
<span class="kn">from</span> <span class="nn">torchvision.datasets.utils</span> <span class="kn">import</span> <span class="n">download_and_extract_archive</span><span class="p">,</span> \
    <span class="n">extract_archive</span><span class="p">,</span> <span class="n">download_url</span><span class="p">,</span> <span class="n">check_integrity</span>

<span class="kn">from</span> <span class="nn">avalanche.benchmarks.datasets.dataset_utils</span> <span class="kn">import</span> \
    <span class="n">default_dataset_location</span>


<div class="viewcode-block" id="DownloadableDataset"><a class="viewcode-back" href="../../../../../autoapi/avalanche/benchmarks/datasets/#avalanche.benchmarks.datasets.downloadable_dataset.DownloadableDataset">[docs]</a><span class="k">class</span> <span class="nc">DownloadableDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">[</span><span class="n">T_co</span><span class="p">],</span> <span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for a downloadable dataset.</span>

<span class="sd">    It is recommended to extend this class if a dataset can be downloaded from</span>
<span class="sd">    the internet. This implementation codes the recommended behaviour for</span>
<span class="sd">    downloading and verifying the dataset.</span>

<span class="sd">    The dataset child class must implement the `_download_dataset`,</span>
<span class="sd">    `_load_metadata` and `_download_error_message` methods</span>

<span class="sd">    The child class, in its constructor, must call the already implemented</span>
<span class="sd">    `_load_dataset` method (otherwise nothing will happen).</span>

<span class="sd">    A further simplification can be obtained by extending</span>
<span class="sd">    :class:`SimpleDownloadableDataset` instead of this class.</span>
<span class="sd">    :class:`SimpleDownloadableDataset` is recommended if a single archive is to</span>
<span class="sd">    be downloaded and extracted to the root folder &quot;as is&quot;.</span>

<span class="sd">    The standardized procedure coded by `_load_dataset` is as follows:</span>

<span class="sd">    - First, `_load_metadata` is called to check if the dataset can be correctly</span>
<span class="sd">      loaded at the `root` path. This method must check if the data found</span>
<span class="sd">      at the `root` path is correct and that metadata can be correctly loaded.</span>
<span class="sd">      If this method succeeds (by returning True) the process is completed.</span>
<span class="sd">    - If `_load_metadata` fails (by returning False or by raising an error),</span>
<span class="sd">      then a download will be attempted if the download flag was set to True.</span>
<span class="sd">      The download must be implemented in `_download_dataset`. The</span>
<span class="sd">      procedure can be drastically simplified by using the `_download_file`,</span>
<span class="sd">      `_extract_archive` and `_download_and_extract_archive` helpers.</span>
<span class="sd">    - If the download succeeds (doesn&#39;t raise an error), then `_load_metadata`</span>
<span class="sd">      will be called again.</span>

<span class="sd">    If an error occurs, the `_download_error_message` will be called to obtain</span>
<span class="sd">    a message (a string) to show to the user. That message should contain</span>
<span class="sd">    instructions on how to download and prepare the dataset manually.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">root</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
            <span class="n">download</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an instance of a downloadable dataset.</span>

<span class="sd">        Consider looking at the class documentation for the precise details on</span>
<span class="sd">        how to extend this class.</span>

<span class="sd">        Beware that calling this constructor only fills the `root` field. The</span>
<span class="sd">        download and metadata loading procedures are triggered only by</span>
<span class="sd">        calling `_load_dataset`.</span>

<span class="sd">        :param root: The root path where the dataset will be downloaded.</span>
<span class="sd">            Consider passing a path obtained by calling</span>
<span class="sd">            `default_dataset_location` with the name of the dataset.</span>
<span class="sd">        :param download: If True, the dataset will be downloaded if needed.</span>
<span class="sd">            If False and the dataset can&#39;t be loaded from the provided root</span>
<span class="sd">            path, an error will be raised when calling the `_load_dataset`</span>
<span class="sd">            method. Defaults to True.</span>
<span class="sd">        :param verbose: If True, some info about the download process will be</span>
<span class="sd">            printed. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">DownloadableDataset</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The path to the dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">download</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">download</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If True, the dataset will be downloaded (only if needed).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If True, some info about the download process will be printed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_load_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The standardized dataset download and load procedure.</span>

<span class="sd">        For more details on the coded procedure see the class documentation.</span>

<span class="sd">        This method shouldn&#39;t be overridden.</span>

<span class="sd">        This method will raise and error if the dataset couldn&#39;t be loaded</span>
<span class="sd">        or downloaded.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metadata_loaded</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">metadata_load_error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">metadata_loaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_metadata</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">metadata_load_error</span> <span class="o">=</span> <span class="n">e</span>

        <span class="k">if</span> <span class="n">metadata_loaded</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Files already downloaded and verified&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">download</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Error loading dataset metadata (dataset download was &#39;</span> \
                  <span class="s1">&#39;not attempted as &quot;download&quot; is set to False)&#39;</span>
            <span class="k">if</span> <span class="n">metadata_load_error</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">metadata_load_error</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_download_dataset</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_error_message</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">err_msg</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_metadata</span><span class="p">():</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_error_message</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s1">&#39;Error loading dataset metadata (... but the download &#39;</span>
                <span class="s1">&#39;procedure completed successfully)&#39;</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_download_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The download procedure.</span>

<span class="sd">        This procedure is called only if `_load_metadata` fails.</span>

<span class="sd">        This method must raise an error if the dataset can&#39;t be downloaded.</span>

<span class="sd">        Hints: don&#39;t re-invent the wheel! There are ready-to-use helper methods</span>
<span class="sd">        like `_download_and_extract_archive`, `_download_file` and</span>
<span class="sd">        `_extract_archive` that can be used.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_load_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The dataset metadata loading procedure.</span>

<span class="sd">        This procedure is called at least once to load the dataset metadata.</span>

<span class="sd">        This procedure should return False if the dataset is corrupted or if it</span>
<span class="sd">        can&#39;t be loaded.</span>

<span class="sd">        :return: True if the dataset is not corrupted and could be successfully</span>
<span class="sd">        loaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_download_error_message</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the error message hinting the user on how to download the</span>
<span class="sd">        dataset manually.</span>

<span class="sd">        :return: A string representing the message to show to the user.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_cleanup_dataset_root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Utility method that can be used to remove the dataset root directory.</span>

<span class="sd">        Can be useful if a cleanup is needed when downloading and extracting the</span>
<span class="sd">        dataset.</span>

<span class="sd">        This method will also re-create the root directory.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_download_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                       <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                       <span class="n">checksum</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Utility method that can be used to download and verify a file.</span>

<span class="sd">        :param url: The download url.</span>
<span class="sd">        :param file_name: The name of the file to save. The file will be saved</span>
<span class="sd">            in the `root` with this name. Always fill this parameter.</span>
<span class="sd">            Don&#39;t pass a path! Pass a file name only!</span>
<span class="sd">        :param checksum: The MD5 hash to use when verifying the downloaded</span>
<span class="sd">            file. Can be None, in which case the check will be skipped.</span>
<span class="sd">            It is recommended to always fill this parameter.</span>
<span class="sd">        :return: The path to the downloaded file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">download_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">),</span> <span class="n">filename</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
                     <span class="n">md5</span><span class="o">=</span><span class="n">checksum</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">/</span> <span class="n">file_name</span>

    <span class="k">def</span> <span class="nf">_extract_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
                         <span class="n">sub_directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">remove_archive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Utility method that can be used to extract an archive.</span>

<span class="sd">        :param path: The complete path to the archive (for instance obtained</span>
<span class="sd">            by calling `_download_file`).</span>
<span class="sd">        :param sub_directory: The name of the sub directory where to extract the</span>
<span class="sd">            archive. Can be None, which means that the archive will be extracted</span>
<span class="sd">            in the root. Beware that some archives already have a root directory</span>
<span class="sd">            inside of them, in which case it&#39;s probably better to use None here.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        :param remove_archive: If True, the archive will be deleted after a</span>
<span class="sd">            successful extraction. Defaults to False.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">sub_directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">extract_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">extract_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">/</span> <span class="n">sub_directory</span>

        <span class="n">extract_archive</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">to_path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">extract_root</span><span class="p">),</span>
                        <span class="n">remove_finished</span><span class="o">=</span><span class="n">remove_archive</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">extract_root</span>

    <span class="k">def</span> <span class="nf">_download_and_extract_archive</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">checksum</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
            <span class="n">sub_directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">remove_archive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Utility that downloads and extracts an archive.</span>

<span class="sd">        :param url: The download url.</span>
<span class="sd">        :param file_name: The name of the archive. The file will be saved</span>
<span class="sd">            in the `root` with this name. Always fill this parameter.</span>
<span class="sd">            Don&#39;t pass a path! Pass a file name only!</span>
<span class="sd">        :param checksum: The MD5 hash to use when verifying the downloaded</span>
<span class="sd">            archive. Can be None, in which case the check will be skipped.</span>
<span class="sd">            It is recommended to always fill this parameter.</span>
<span class="sd">        :param sub_directory: The name of the sub directory where to extract the</span>
<span class="sd">            archive. Can be None, which means that the archive will be extracted</span>
<span class="sd">            in the root. Beware that some archives already have a root directory</span>
<span class="sd">            inside of them, in which case it&#39;s probably better to use None here.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        :param remove_archive: If True, the archive will be deleted after a</span>
<span class="sd">            successful extraction. Defaults to False.</span>
<span class="sd">        :return: The path to the extracted archive. If `sub_directory` is None,</span>
<span class="sd">            then this will be the `root` path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sub_directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">extract_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">extract_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">/</span> <span class="n">sub_directory</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">download_and_extract_archive</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">),</span> <span class="n">extract_root</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">extract_root</span><span class="p">),</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">md5</span><span class="o">=</span><span class="n">checksum</span><span class="p">,</span> <span class="n">remove_finished</span><span class="o">=</span><span class="n">remove_archive</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">extract_root</span>

    <span class="k">def</span> <span class="nf">_check_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span> <span class="n">checksum</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Utility method to check a file.</span>

<span class="sd">        :param path: The path to the file.</span>
<span class="sd">        :param checksum: The MD5 hash to use.</span>
<span class="sd">        :return: True if the MD5 hash of the file matched the given one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">check_integrity</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">md5</span><span class="o">=</span><span class="n">checksum</span><span class="p">)</span></div>


<div class="viewcode-block" id="SimpleDownloadableDataset"><a class="viewcode-back" href="../../../../../autoapi/avalanche/benchmarks/datasets/#avalanche.benchmarks.datasets.downloadable_dataset.SimpleDownloadableDataset">[docs]</a><span class="k">class</span> <span class="nc">SimpleDownloadableDataset</span><span class="p">(</span><span class="n">DownloadableDataset</span><span class="p">[</span><span class="n">T_co</span><span class="p">],</span> <span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for a downloadable dataset consisting of a single archive file.</span>

<span class="sd">    It is recommended to extend this class if a dataset can be downloaded from</span>
<span class="sd">    the internet as a single archive. For multi-file implementation or if</span>
<span class="sd">    a more fine-grained control is required, consider extending</span>
<span class="sd">    :class:`DownloadableDataset` instead.</span>

<span class="sd">    This is a simplified version of :class:`DownloadableDataset` where the</span>
<span class="sd">    following assumptions must hold:</span>
<span class="sd">    - The dataset is made of a single archive.</span>
<span class="sd">    - The archive must be extracted to the root folder &quot;as is&quot; (which means</span>
<span class="sd">        that no subdirectories must be created).</span>

<span class="sd">    The child class is only required to extend the `_load_metadata` method,</span>
<span class="sd">    which must check the dataset integrity and load the dataset metadata.</span>

<span class="sd">    Apart from that, the same assumptions of :class:`DownloadableDataset` hold.</span>
<span class="sd">    Remember to call the `_load_dataset` method in the child class constructor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">root_or_dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">checksum</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
            <span class="n">download</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an instance of a simple downloadable dataset.</span>

<span class="sd">        Consider looking at the class documentation for the precise details on</span>
<span class="sd">        how to extend this class.</span>

<span class="sd">        Beware that calling this constructor only fills the `root` field. The</span>
<span class="sd">        download and metadata loading procedures are triggered only by</span>
<span class="sd">        calling `_load_dataset`.</span>

<span class="sd">        :param root_or_dataset_name: The root path where the dataset will be</span>
<span class="sd">            downloaded. If a directory name is passed, then the root obtained by</span>
<span class="sd">            calling `default_dataset_location` will be used (recommended).</span>
<span class="sd">            To check if this parameter is a path, the constructor will check if</span>
<span class="sd">            it contains the &#39;\&#39; or &#39;/&#39; characters or if it is a Path instance.</span>
<span class="sd">        :param url: The url of the archive.</span>
<span class="sd">        :param checksum: The MD5 hash to use when verifying the downloaded</span>
<span class="sd">            archive. Can be None, in which case the check will be skipped.</span>
<span class="sd">            It is recommended to always fill this parameter.</span>
<span class="sd">        :param download: If True, the dataset will be downloaded if needed.</span>
<span class="sd">            If False and the dataset can&#39;t be loaded from the provided root</span>
<span class="sd">            path, an error will be raised when calling the `_load_dataset`</span>
<span class="sd">            method. Defaults to False.</span>
<span class="sd">        :param verbose: If True, some info about the download process will be</span>
<span class="sd">            printed. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checksum</span> <span class="o">=</span> <span class="n">checksum</span>

        <span class="n">is_path</span> <span class="o">=</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">root_or_dataset_name</span><span class="p">,</span> <span class="n">Path</span><span class="p">)</span> <span class="ow">or</span>
                   <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">root_or_dataset_name</span> <span class="ow">or</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">root_or_dataset_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_path</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">root_or_dataset_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">default_dataset_location</span><span class="p">(</span><span class="n">root_or_dataset_name</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">SimpleDownloadableDataset</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">root</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="n">download</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_download_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_download_and_extract_archive</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">checksum</span><span class="p">,</span> <span class="n">sub_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">remove_archive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_download_error_message</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;Error downloading the dataset. Consider downloading &#39;</span> \
               <span class="s1">&#39;it manually at: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">+</span> <span class="s1">&#39; and placing it &#39;</span> \
               <span class="s1">&#39;in: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span></div>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;DownloadableDataset&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SimpleDownloadableDataset&#39;</span>
<span class="p">]</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, ContinualAI.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>